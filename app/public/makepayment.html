<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>PadPal - Make a Payment</title>

    <!-- Bootstrap CSS CDN -->
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    />
    <!-- Our Custom CSS -->
    <link rel="stylesheet" href="./css/style.css" />
    <!-- Javascript -->
    <script src="./javascript/loadInfo.js"></script>
  </head>
  <body>
    <!-- Script for session information and payment submission -->
    <script>
      window.onload = function () {
        loadInfo();
        document.querySelector('input[name="username"]').value = getUsername();
      };

      async function submitPayment(event) {
        event.preventDefault();

        const username = getUsername();
        const amount = document.getElementById("amount").value;
        const date = document.getElementById("date").value;

        const data = {
          username,
          amount,
          date,
        };

        try {
          const response = await fetch("/makePayment", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
          });

          if (response.ok) {
            window.location.href = "/payments.html";
          } else {
            const errorMessage = await response.text();
            alert(errorMessage);
          }
        } catch (error) {
          alert(
            "An error occurred while processing your payment. Please try again later."
          );
        }
      }
    </script>
    <div class="wrapper">
      <!-- Sidebar Holder -->
      <nav id="sidebar">
        <div class="sidebar-header">
          <h3>Welcome, <span id="username-display"></span>!</h3>
        </div>

        <ul class="list-unstyled components">
          <li><a href="home.html">Home</a></li>
          <li><a href="payments.html">Payments</a></li>
          <li><a href="maintenance.html">Maintenance</a></li>
          <li><a href="contact.html">Contact Us</a></li>
        </ul>

        <ul class="list-unstyled bottomButton">
          <li>
            <a href="login.html" class="logout">Log Out</a>
          </li>
        </ul>
      </nav>

      <!-- Page Content Holder -->
      <div id="content">
        <header>
          <h1>PadPal</h1>
          <p id="address"></p>
        </header>
        <hr />
        <h2>Make a payment</h2>
        <!-- Payment form -->
        <form id="paymentform" method="post" onsubmit="submitPayment(event)">
          <div class="form-group">
            <label for="amount">Amount</label>
            <input
              type="number"
              step="0.01"
              class="form-control"
              id="amount"
              name="amount"
              placeholder="Enter amount"
              required
            />
          </div>
          <div class="form-group">
            <label for="date">Date</label>
            <input
              type="date"
              class="form-control"
              id="date"
              name="date"
              placeholder="Enter date"
              min=""
              required
            />
          </div>
          <!-- Script to get current date so date input field disallows prior dates for payment -->
          <script>
            const today = new Date().toISOString().split('T')[0];
            document.getElementById("date").setAttribute("min", today);
          </script>
          <h2>Credit Card Information</h2>
          <div class="form-group">
            <label for="cardnumber">Card Number</label>
            <input
              type="number"
              class="form-control"
              id="cardnumber"
              placeholder="Enter card number"
            />
          </div>
          <div class="form-group">
            <label for="zip">Zip Code</label>
            <input
              type="number"
              class="form-control"
              id="zip"
              placeholder="Enter billing zip code"
              max="99999"
              min="00000"
            />
          </div>
          <div class="form-group">
            <label for="cvv">CVV</label>
            <input
              type="number"
              class="form-control"
              id="cvv"
              placeholder="Enter CVV"
              max="999"
              min="000"
            />
          </div>
          <div class="form-group">
            <label for="expdate">Expiration Date</label>
            <input
              type="month"
              class="form-control"
              id="expdate"
              placeholder="Enter expiration date"
            />
          </div>
          <input type="hidden" name="username" value="" />
          <button type="submit" class="btn btn-primary">Submit</button>
        </form>
      </div>
    </div>
  </body>
</html>
