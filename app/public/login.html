<!DOCTYPE html>
<html lang="en">

<head>
    <title>PadPal - Login</title>
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/loginstyle.css">
    <script>
        async function validateCredentials() {
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            try {
                const response = await fetch('/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    username: username,
                    password: password
                })
                });

                if (response.ok) {
                const data = await response.json();
                
                sessionStorage.setItem('username', data.username);
                sessionStorage.setItem('name', data.name);
                sessionStorage.setItem('email', data.email);
                sessionStorage.setItem('address', data.address);
                sessionStorage.setItem('monthrent', data.monthrent);

                window.location.href = "/home.html";
                } else {
                alert("Login Failed");
                }
            } catch (error) {
                alert("An error occurred while logging in. Please try again later.");
            }
        }
        
    </script>
</head>

<body>
    <header>
        <h1>PadPal</h1>
    </header>
    <section class="tooltab">
        <form method="post" action="/login" onsubmit="event.preventDefault(); validateCredentials();">
            <h2>Login</h2>
            <h3>Username</h3>
            <input type="text" id="username" name="username" placeholder="Enter username">
            <h3>Password</h3>
            <input type="password" id="password" name="password" placeholder="Enter password">
            <br>
            <input type="submit" value="Enter" name="submit"></input>
            <br>
            <button>
                <a href="./createuser.html">Create new user</a>
              </button>
        </form>
    </section>

    <section class="tooltab demoView">
        <style>
            .demoView {
                margin-top: 50px;
            }
            th{
                padding: 10px 30px;
                text-align: center;
            }
        </style>
        <h2>Users for demo view</h2>
        <table id="users">
            <thead>
            <tr>
                <th>Username</th>
                <th>Name</th>
                <th>Email</th>
                <th>Address</th>
            </tr>
            </thead>
            <tbody></tbody>
        </table>
    </section>
    

  <script>
    async function fetchUsers() {
      const response = await fetch('/clients');
      const data = await response.json();
      const clientsTable = document.getElementById('users').getElementsByTagName('tbody')[0];
      clientsTable.innerHTML = '';

      data.forEach(client => {
        const newRow = clientsTable.insertRow();
        newRow.innerHTML = `
          <td>${client.username}</td>
          <td>${client.name}</td>
          <td>${client.email}</td>
          <td>${client.address}</td>
        `;
      });
    }

    fetchUsers();
  </script>
</body>
</html>